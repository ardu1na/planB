{% extends 'dashboard/elements/layouts/admin.html' %}

{% load static widget_tweaks %}

{% block additional_css %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
{% endblock %}

{% block content %}



<!-- MAIN USUARIOS -->




    <div class="row">



    
        <div class="row page-titles">
            <ol class="breadcrumb">        
                <li class="breadcrumb-item"><a href="{% url 'dashboard:index' %}">Inicio</a></li>
                {% if 'pk' in request.resolver_match.kwargs %}
                <li class="breadcrumb-item"><a href="{% url 'dashboard:barrio' pk=barrio.pk %}" >{{barrio}}</a></li>
                {% endif %}
                <li class="breadcrumb-item active"><a>Usuarios</a></li>
            </ol>
        </div>

        
        
        <div class="col-xl-12">            
            <div class="card students-list">
                 

                <form  method="post" enctype="multipart/form-data" novalidate autocomplete="off">
                    {% csrf_token %}
                    <div class="modal-body">
                        <div class="pt-1 pb-4">
                            <div class="formcontrol">                                         
                                <div class="form-floating mb-3">

                                    <div class="form-group my-3">
                                        
                                        {{addform.alarma_vecinal}}
                                    </div>

                                    <div class="my-4">
                                        <p>Elije una vivienda...</p>                 
                                        <select id="vivienda" class="form-control" name="vivienda">

                                            {% for s in viviendas %}

                                                <option id="{{s.alarma_vecinal.id}}" value="{{s.id}}"> {{s}}</option>

                                            {%endfor%}
                                        </select>
                                    </div>






                                    <div class="form-group my-3">
                                        
                                        {{addform.nombre}}
                                    </div>
                                    <div class="form-group my-3">
                                        {{addform.apellido}}
                                    </div>
                                    <div class="form-group my-3">
                                        {{addform.telefono}}
                                    </div>

                                    <div class="form-group my-3">
                                        {{addform.genero}}
                                    </div>


                                    <div class="form-group my-3">
                                        {{addform.fecha_de_nacimiento}}
                                    </div>

                                    <div class="form-group my-3">
                                        {{addform.nota}}
                                    </div>

                                    <div class="mb-3 col-md-6">
                                        <div class="avatar-upload">
                                            <div class="avatar-edit">
                                                {{ addform.avatar|attr:"type:file" }}
                                                <label for="id_avatar"><i class="fas fa-pencil-alt"></i></label>
                                            </div>
                                            <div class="avatar-preview">
                                            {% if addform.instance.avatar %}
                                            <div id="imagePreview" style="background-image: url('{{ addform.instance.avatar.url }}');">
                                            {% else %}
                                            <div id="imagePreview">
                                            {% endif %}
                                            
                                            </div>
                                        </div>

                                </div>
                            </div>       
    
                            
                        </div>
                        <div class="form-floating my-3 text-center">
                            <button type="submit" class=" fs-3 shadow-sm btn btn-secondary" name="addnew"><i class="fa fa-plus me-2 fs-3 me-3"></i> Agregar </button>
                        </div>
                    </div>

                </form>

            </div>
        </div>
    </div>
<!-- end MAIN usuarios -->


<!-- modals delete usuarios -->
    {% for usuario in usuarios %}
        <div class="modal" id="deleteusuario{{usuario.id}}">
            {% include 'dashboard/sistema/barrios/deleteusuario.html' %}
        </div>
    {% endfor %}


<!-- START modal add usuario -->
<div class="modal fade " id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Nuevo Usuario</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>           
            <form  method="post" enctype="multipart/form-data" novalidate autocomplete="off">
                {% csrf_token %}
                    <div class="modal-body">
                        <div class="pt-1 pb-4">
                            <div class="formcontrol">                                         
                                <div class="form-floating mb-3">

                                    <div class="form-group my-3">
                                        
                                        {{addform.alarma_vecinal}}
                                    </div>

                                    <div id="vdiv" class="form-group my-3">
                                        
                                        {{addform.vivienda}}
                                    </div>

                                    <div class="form-group my-3">
                                        
                                        {{addform.nombre}}
                                    </div>
                                    <div class="form-group my-3">
                                        {{addform.apellido}}
                                    </div>
                                    <div class="form-group my-3">
                                        {{addform.telefono}}
                                    </div>

                                    <div class="form-group my-3">
                                        {{addform.genero}}
                                    </div>


                                    <div class="form-group my-3">
                                        {{addform.fecha_de_nacimiento}}
                                    </div>

                                    <div class="form-group my-3">
                                        {{addform.nota}}
                                    </div>

                                    <div class="mb-3 col-md-6">
                                        <div class="avatar-upload">
                                           <div class="avatar-edit">
                                              {{ addform.avatar|attr:"type:file" }}
                                              <label for="id_avatar"><i class="fas fa-pencil-alt"></i></label>
                                           </div>
                                           <div class="avatar-preview">
                                            {% if addform.instance.avatar %}
                                            <div id="imagePreview" style="background-image: url('{{ addform.instance.avatar.url }}');">
                                          {% else %}
                                            <div id="imagePreview">
                                          {% endif %}
                                          
                                           </div>
                                     </div>

                                </div>
                            </div>       
    
                            
                        </div>
                        <div class="form-floating my-3 text-center">
                            <button type="submit" class=" fs-3 shadow-sm btn btn-secondary" name="addnew"><i class="fa fa-plus me-2 fs-3 me-3"></i> Agregar </button>
                        </div>
                    </div>
                </form>


        </div>
    </div>
</div>
<!-- END modal add usuario -->
{% endblock %}


{% block additional_js %}




<script>
    function readURL(input) {
 
       if (input.files && input.files[0]) {
             var reader = new FileReader();
             reader.onload = function(e) {
                $('#imagePreview').css('background-image', 'url('+e.target.result +')');
                $('#imagePreview').hide();
                $('#imagePreview').fadeIn(650);
             }
             reader.readAsDataURL(input.files[0]);
       }
    }
    $("#id_avatar").change(function() {
       readURL(this);
    });
 </script> 


 <script>             
    var $viviendaSelect = $('#vivienda');
    var $alarma = $('#alarma_vecinal');
    $alarma.on('change', filterServices);

    function filterServices() {
        var alarmaId = $('#alarma_vecinal').val();
        
        $viviendaSelect.find('option').each(function() {
            var $viviendaOption = $(this);
            
            if ($viviendaOption.attr('id') === alarmaId) {
                $viviendaOption.show();
            } else {
                $viviendaOption.hide();
            }
        });
        
        $viviendaSelect.val($viviendaSelect.find('option:visible:first').val());
    }
</script>



{% endblock %}